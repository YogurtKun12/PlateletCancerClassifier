q()
q()
q()
# ------------------- Run App -------------------
shinyApp(ui = ui, server = server)
install.packages(c("shiny", "DT", "ggplot2", "dplyr", "shinythemes"))
example_data <- data.frame(
Sample = paste0("S", 1:20),
GeneA = rnorm(20, 50, 15),
GeneB = rnorm(20, 30, 10),
Group = rep(c("Control", "Treatment"), each = 10),
Predicted_Class = sample(c("Responsive", "Non-responsive"), 20, replace = TRUE)
)
install.packages(c("shiny", "DT", "ggplot2", "dplyr", "shinythemes"))
# app.R - BIO215 Coursework 2: Full Shiny App (Session 5 + Session 6)
library(shiny)
library(DT)
library(ggplot2)
library(dplyr)
# ------------------- 模拟数据（可替换为你的真实数据） -------------------
set.seed(123)
example_data <- data.frame(
Sample = paste0("S", 1:20),
GeneA = rnorm(20, 50, 15),
GeneB = rnorm(20, 30, 10),
Group = rep(c("Control", "Treatment"), each = 10),
Predicted_Class = sample(c("Responsive", "Non-responsive"), 20, replace = TRUE)
)
# 模拟预测模型（简单逻辑回归示例）
predict_multiple <- function(data, geneA_col, geneB_col) {
data %>%
mutate(
logit = -2 + 0.1 * .data[[geneA_col]] - 0.08 * .data[[geneB_col]] + rnorm(n(), 0, 0.5),
Probability = plogis(logit),
Predicted_Class = ifelse(Probability > 0.5, "Responsive", "Non-responsive")
) %>%
select(Sample, all_of(c(geneA_col, geneB_col)), Probability, Predicted_Class)
}
predict_single <- function(geneA, geneB) {
logit <- -2 + 0.1 * geneA - 0.08 * geneB
prob <- plogis(logit)
class <- ifelse(prob > 0.5, "Responsive", "Non-responsive")
data.frame(GeneA = geneA, GeneB = geneB, Probability = round(prob, 3), Predicted_Class = class)
}
# ------------------- UI -------------------
ui <- navbarPage(
title = "BIO215 Coursework 2: Gene Expression Analyzer",
theme = shinythemes::shinytheme("flatly"),
# ===== 1. Home Page =====
tabPanel("Home",
fluidPage(
titlePanel("Welcome to Gene Expression Dashboard"),
p("This app integrates data upload, visualization, download, and predictive modeling."),
tags$ul(
tags$li("Upload CSV with gene expression data"),
tags$li("Explore data in table and plots"),
tags$li("Download results"),
tags$li("Predict treatment response for multiple or single samples")
),
br(),
img(src = "https://www.rstudio.com/wp-content/uploads/2014/06/shiny.png", height = "100px")
)
),
# ===== 2. Data Table Page =====
tabPanel("Data Table",
sidebarLayout(
sidebarPanel(
fileInput("file", "Upload CSV File", accept = ".csv"),
checkboxInput("header", "Header", TRUE),
radioButtons("sep", "Separator", choices = c(Comma = ",", Semicolon = ";", Tab = "\t"), selected = ",")
),
mainPanel(
DT::dataTableOutput("table")
)
)
),
# ===== 3. Visualization Page =====
tabPanel("Visualization",
sidebarLayout(
sidebarPanel(
uiOutput("var_x"),
uiOutput("var_y"),
uiOutput("var_color"),
sliderInput("point_size", "Point Size", 1, 10, 3)
),
mainPanel(
plotOutput("scatterplot", height = "500px"),
downloadButton("download_plot", "Download Plot")
)
)
),
# ===== 4. Download Page =====
tabPanel("Download",
fluidPage(
h3("Download Processed Data & Plots"),
downloadButton("download_data", "Download Current Data (CSV)"),
br(), br(),
downloadButton("download_plot2", "Download Latest Plot (PNG)"),
br(), br(),
p("Note: Only the latest scatterplot is available for download.")
)
),
# ===== 5. Prediction (Multiple) =====
tabPanel("Prediction (Multiple)",
sidebarLayout(
sidebarPanel(
uiOutput("geneA_select"),
uiOutput("geneB_select"),
actionButton("predict_multi", "Run Prediction", class = "btn-primary")
),
mainPanel(
h4("Prediction Results"),
DT::dataTableOutput("pred_multi_table"),
downloadButton("download_pred_multi", "Download Predictions")
)
)
),
# ===== 6. Prediction (Single) =====
tabPanel("Prediction (Single)",
fluidPage(
titlePanel("Single Sample Prediction"),
sidebarLayout(
sidebarPanel(
numericInput("single_geneA", "Gene A Expression", value = 50, min = 0),
numericInput("single_geneB", "Gene B Expression", value = 30, min = 0),
actionButton("predict_single", "Predict", class = "btn-success")
),
mainPanel(
h4("Prediction Result"),
tableOutput("pred_single_table")
)
)
)
)
)
# ------------------- SERVER -------------------
server <- function(input, output, session) {
# Reactive data
data <- reactive({
if (!is.null(input$file)) {
read.csv(input$file$datapath, header = input$header, sep = input$sep)
} else {
example_data
}
})
# ===== Data Table =====
output$table <- DT::renderDataTable({
DT::datatable(data(), options = list(pageLength = 10, scrollX = TRUE))
})
# ===== Dynamic UI for Visualization =====
output$var_x <- renderUI({
selectInput("x_var", "X-axis Variable", choices = names(data()))
})
output$var_y <- renderUI({
selectInput("y_var", "Y-axis Variable", choices = names(data()))
})
output$var_color <- renderUI({
selectInput("color_var", "Color by", choices = c("None", names(data())), selected = "Group")
})
# ===== Scatterplot =====
current_plot <- reactive({
req(input$x_var, input$y_var)
p <- ggplot(data(), aes_string(x = input$x_var, y = input$y_var)) +
geom_point(aes_string(color = if(input$color_var != "None") input$color_var else NULL),
size = input$point_size, alpha = 0.7) +
theme_minimal() +
labs(title = paste(input$y_var, "vs", input$x_var))
if(input$color_var != "None") p <- p + labs(color = input$color_var)
p
})
output$scatterplot <- renderPlot({
current_plot()
})
# Download plot
output$download_plot <- downloadHandler(
filename = function() { "scatterplot.png" },
content = function(file) {
ggsave(file, current_plot(), device = "png", width = 10, height = 6)
}
)
output$download_plot2 <- downloadHandler(
filename = function() { "scatterplot.png" },
content = function(file) {
ggsave(file, current_plot(), device = "png", width = 10, height = 6)
}
)
# ===== Download Data =====
output$download_data <- downloadHandler(
filename = function() { "processed_data.csv" },
content = function(file) {
write.csv(data(), file, row.names = FALSE)
}
)
# ===== Prediction Multiple =====
output$geneA_select <- renderUI({
selectInput("geneA_col", "Select Gene A", choices = names(data()))
})
output$geneB_select <- renderUI({
selectInput("geneB_col", "Select Gene B", choices = names(data()))
})
pred_multi <- eventReactive(input$predict_multi, {
req(input$geneA_col, input$geneB_col)
predict_multiple(data(), input$geneA_col, input$geneB_col)
})
output$pred_multi_table <- DT::renderDataTable({
DT::datatable(pred_multi(), options = list(pageLength = 10))
})
output$download_pred_multi <- downloadHandler(
filename = "predictions_multiple.csv",
content = function(file) {
write.csv(pred_multi(), file, row.names = FALSE)
}
)
# ===== Prediction Single =====
pred_single <- eventReactive(input$predict_single, {
predict_single(input$single_geneA, input$single_geneB)
})
output$pred_single_table <- renderTable({
pred_single()
}, digits = 3)
}
# ------------------- Run App -------------------
shinyApp(ui = ui, server = server)
# ------------------- Run App -------------------
shinyApp(ui = ui, server = server)
shinyApp(ui, server)
library(shiny)
shinyApp(ui = ui, server = server)
rsconnect::setAccountInfo(name='xiaokunxi812', token='A0F47BC3454705F2E7A539AF7CBF0D38', secret='t2v4jtIx1Ky6t1Af6qvHEX0fkHFmtGJm4SpBd+ht')
library(rsconnect)
rsconnect::setAccountInfo(name='xiaokunxi812', token='A0F47BC3454705F2E7A539AF7CBF0D38', secret='t2v4jtIx1Ky6t1Af6qvHEX0fkHFmtGJm4SpBd+ht')
# ------------------- 运行 -------------------
shinyApp(ui = ui, server = server)
# 3. 部署（确保当前工作目录就是放 app.R 的文件夹）
rsconnect::deployApp(appName = "bio215-m6a",   # 自定义名字，可改
appTitle = "m6A Prediction Server")
appTitle = "m6A Prediction Server")
# 1. 安装 rsconnect（只需要一次）
install.packages("rsconnect")
# 2. 加载并登录（只做一次）
library(rsconnect)
rsconnect::setAccountInfo(
name   = 'xiaokunxi812',                         # 你的用户名
token  = 'A0F47BC3454705F2E7A539AF7CBF0D38',   # 你的 Token
secret = 't2v4jtIx1Ky6t1Af6qvHEX0fkHFmtGJm4SpBd+ht'  # 你的 Secret
)
# 3. 部署（确保当前工作目录就是放 app.R 的文件夹）
rsconnect::deployApp(appName = "bio215-m6a",   # 自定义名字，可改
appTitle = "m6A Prediction Server")
# 1. 安装 rsconnect（只需要一次）
install.packages("rsconnect")
# 2. 加载并登录（只做一次）
library(rsconnect)
rsconnect::setAccountInfo(
name   = 'xiaokunxi812',                         # 你的用户名
token  = 'A0F47BC3454705F2E7A539AF7CBF0D38',   # 你的 Token
secret = 't2v4jtIx1Ky6t1Af6qvHEX0fkHFmtGJm4SpBd+ht'  # 你的 Secret
)
setwd("D：/BIO215/Practical7")          # 改成你自己的路径！
# 基本摘要
summary(abalone)
# 现在运行基本摘要
summary(abalone)
getwd()
save(multiclass_features, file = "PlateletCancerClassifier/data/multiclass_features.rda")
# 1. 设置工作目录到你的包根目录（把路径改成你的实际路径！）
# 示例：如果你的包文件夹在 D 盘，改成 "D:/PlateletCancerClassifier"
setwd("D:/PlateletCancerClassifier")  # <-- 修改这里！
# 2. 创建 data 文件夹（如果不存在）
if (!dir.exists("data")) dir.create("data")
# 3. 定义二分类特征（84 个基因）
binary_features <- c(
"ENSG00000155657", "ENSG00000229164", "ENSG00000014216", "ENSG00000129353",
"ENSG00000174501", "ENSG00000072110", "ENSG00000163492", "ENSG00000186854",
"ENSG00000150093", "ENSG00000266371", "ENSG00000211752", "ENSG00000143546",
"ENSG00000185989", "ENSG00000107890", "ENSG00000177455", "ENSG00000102886",
"ENSG00000087460", "ENSG00000124491", "ENSG00000241106", "ENSG00000186265",
"ENSG00000140479", "ENSG00000112078", "ENSG00000198858", "ENSG00000155984",
"ENSG00000126353", "ENSG00000168685", "ENSG00000185485", "ENSG00000071127",
"ENSG00000160654", "ENSG00000123091", "ENSG00000147394", "ENSG00000108846",
"ENSG00000143162", "ENSG00000100994", "ENSG00000149311", "ENSG00000163519",
"ENSG00000110651", "ENSG00000005961", "ENSG00000100813", "ENSG00000157978",
"ENSG00000145241", "ENSG00000213402", "ENSG00000197880", "ENSG00000137076",
"ENSG00000211786", "ENSG00000174175", "ENSG00000131797", "ENSG00000100345",
"ENSG00000265148", "ENSG00000100266", "ENSG00000183918", "ENSG00000234284",
"ENSG00000181104", "ENSG00000162894", "ENSG00000160991", "ENSG00000086232",
"ENSG00000147650", "ENSG00000181045", "ENSG00000156515", "ENSG00000170486",
"ENSG00000169398", "ENSG00000160404", "ENSG00000152556", "ENSG00000156931",
"ENSG00000138795", "ENSG00000182230", "ENSG00000099785", "ENSG00000117560",
"ENSG00000235162", "ENSG00000132485", "ENSG00000119862", "ENSG00000180354",
"ENSG00000214900", "ENSG00000113194", "ENSG00000112031", "ENSG00000184500",
"ENSG00000198851", "ENSG00000198833", "ENSG00000089012", "ENSG00000143167",
"ENSG00000029534", "ENSG00000106868", "ENSG00000104998"
)
# 4. 保存二分类特征
save(binary_features, file = "data/binary_features.rda")
# 5. 定义多分类特征（202 个基因）
"ENSG00000006638", "ENSG00000023902", "ENSG00000066044", "ENSG00000068383",
"ENSG00000082781", "ENSG00000090372", "ENSG00000090565", "ENSG00000090975",
"ENSG00000104964", "ENSG00000106976", "ENSG00000108100", "ENSG00000108840",
"ENSG00000115756", "ENSG00000115758", "ENSG00000116685", "ENSG00000117691",
"ENSG00000124535", "ENSG00000125753", "ENSG00000129355", "ENSG00000129968",
"ENSG00000137198", "ENSG00000140859", "ENSG00000146535", "ENSG00000148426",
"ENSG00000158457", "ENSG00000159069", "ENSG00000159202", "ENSG00000159840",
"ENSG00000166337", "ENSG00000167522", "ENSG00000167657", "ENSG00000167705",
"ENSG00000176170", "ENSG00000176463", "ENSG00000178922", "ENSG00000179632",
"ENSG00000185340", "ENSG00000185963", "ENSG00000188536", "ENSG00000188986",
"ENSG00000225205", "ENSG00000260831", "ENSG00000272888", "ENSG00000002330",
"ENSG00000064961", "ENSG00000066923", "ENSG00000068831", "ENSG00000087460",
"ENSG00000100941", "ENSG00000103266", "ENSG00000105711", "ENSG00000108848",
"ENSG00000113758", "ENSG00000115590", "ENSG00000116251", "
# 检查是否成功
devtools::find_rtools()
# 安装 devtools（只需运行一次，会下载一些依赖包，耐心等2-5分钟）
install.packages("devtools")
# 加载 devtools
library(devtools)
devtools::find_rtools()
update.packages("cli")
update.packages("cli")
install.packages("cli", repos = "https://mirrors.ustc.edu.cn/CRAN/")
install.packages("cli", repos = "https://mirrors.ustc.edu.cn/CRAN/")
# 3. 重启后，重新加载 devtools
library(devtools)
options(repos = c(CRAN = "https://mirrors.ustc.edu.cn/CRAN/"))
remove.packages("cli")
